!function() {
    function e() {
        return {
            renderAddCategory: function() {
                var e = $("#addCategoryView").html();
                Finch.navigate("addCategory"), $("#hide").hide(), $(".dashboard").hide(), i().render(e);
            },
            rendercategoryData: function() {
                var e = JSON.parse(i().getCookie()).categoryData_id;
                if (null == e) Finch.navigate("dashboard"); else {
                    $("#hide").hide(), $(".editDataView").hide(), $(".editCategoryDiv").hide(), $(".addDataView").hide();
                    var t = "http://localhost/eWallet/server/data/" + e;
                    r().get(t, "categoryView", "categoryData");
                }
            },
            renderaddCategoryData: function() {
                var e = $("#addDataView").html();
                Finch.navigate("addCategoryData"), $("#hide").hide(), $(".categoryView").hide(), 
                i().render(e);
            }
        };
    }
    function n() {
        return {
            addCategory: function(e, t) {
                return r().post({
                    url: "category/" + t,
                    payload: e
                });
            },
            deleteCategory: function(e) {
                return r().delete({
                    url: "category/" + e,
                    id: e
                });
            },
            editCategory: function(e, t) {
                return r().put({
                    url: "category/" + e,
                    id: e,
                    title: t
                });
            },
            addData: function(e, t) {
                return r().post({
                    url: "data/" + t,
                    payload: e
                });
            },
            deleteData: function(e) {
                return r().delete({
                    url: "data/" + e,
                    id: e
                });
            },
            editData: function(e, t) {
                return r().put({
                    url: "data/" + e,
                    id: e,
                    title: t
                });
            }
        };
    }
    function t() {
        return {
            renderForgot: function() {
                var e = $("#forgotView").html();
                Finch.navigate("forgot"), i().render(e);
            },
            renderLogin: function() {
                if (JSON.parse(i().getCookie())) Finch.navigate("dashboard"); else {
                    var e = $("#loginView").html();
                    Finch.navigate("login"), i().render(e);
                }
            },
            renderRegister: function() {
                var e = $("#registerView").html();
                Finch.navigate("register"), i().render(e);
            },
            renderDashboard: function() {
                $("#dashboardView").html();
                var e = JSON.parse(i().getCookie()), t = e.token, a = e.user_id;
                if (null == t) Finch.navigate("login"); else {
                    $("#hide").hide(), $(".addCategoryView").hide(), $(".small_content").hide(), $(".categoryView").hide(), 
                    $(".editView").hide(), $(".editDataView").hide(), $(".addDataView").hide();
                    var o = "http://localhost/eWallet/server/category/" + a;
                    r().get(o, "dashboardView", "dashboard");
                }
            }
        };
    }
    function o() {
        return {
            login: function(e) {
                return r().post({
                    url: "login",
                    payload: e
                });
            },
            register: function(e) {
                return r().post({
                    url: "register",
                    payload: e
                });
            },
            forgot: function(e) {
                return r().post({
                    url: "forgot",
                    payload: e
                });
            },
            recover: function(e) {
                return r().post({
                    url: "recover",
                    payload: e
                });
            },
            resendToken: function(e) {
                return r().post({
                    url: "resendToken",
                    payload: e
                });
            }
        };
    }
    function i() {
        return {
            render: function(e) {
                var t = Handlebars.compile(e), a = t(t);
                $("#render").html(a);
            },
            log: function(e) {
                console.log(e);
            },
            setCookie: function(e) {
                localStorage.setItem("ewallet", e);
            },
            getCookie: function() {
                return localStorage.getItem("ewallet");
            }
        };
    }
    function r() {
        return {
            post: function(e) {
                return $.ajax({
                    type: "post",
                    data: e.payload,
                    url: "http://localhost/eWallet/server/" + e.url,
                    dataType: "json"
                });
            },
            delete: function(a) {
                $.ajax({
                    type: "delete",
                    url: "http://localhost/eWallet/server/" + a.url,
                    success: function(e) {
                        var t = $("#deleteCategory-" + a.id).closest("tr");
                        $(t).remove();
                    },
                    error: function(e) {
                        alert("Error!");
                    }
                });
            },
            put: function(r) {
                $.ajax({
                    type: "put",
                    data: JSON.stringify(r.title),
                    url: "http://localhost/eWallet/server/" + r.url,
                    dataType: "json",
                    success: function(e) {
                        var t = e.data.title;
                        $(".title-" + r.id).text(t), $(".title-" + r.id).show(), $("#editCategoryField-" + r.id).hide();
                        var a = e.data.field_name, o = e.data.description;
                        $(".fieldName-" + r.id).text(a), $(".description-" + r.id).text(o), $(".fieldName-" + r.id).show(), 
                        $(".description-" + r.id).show(), $("#editTitleField-" + r.id).hide(), $("#editDataField-" + r.id).hide();
                    },
                    error: function(e) {
                        alert("Error!");
                    }
                });
            },
            get: function(e, o, r) {
                var t = JSON.parse(i().getCookie()).token;
                $.ajax({
                    method: "GET",
                    dataType: "json",
                    headers: {
                        token: t
                    },
                    url: e,
                    success: function(e) {
                        $(".dashboard").hide();
                        var t = $("#" + o).html();
                        Finch.navigate(r);
                        var a = Handlebars.compile(t);
                        $("body").append(a({
                            item: e
                        }));
                    },
                    error: function(e) {
                        alert("Error!");
                    }
                });
            }
        };
    }
    $(document).on("submit", "#addCategory-form", function(e) {
        e.preventDefault();
        var t = i().getCookie(), a = (t = JSON.parse(t)).user_id, o = {};
        o.title = document.forms.addform.title.value;
        var r = JSON.stringify(o);
        n().addCategory(r, a).then(function(e) {
            Finch.navigate("dashboard");
        }, function(e) {
            i().log(e);
        });
    }), $(document).on("click", ".delete", function(e) {
        e.preventDefault();
        var t = $(this).data("route");
        n().deleteCategory(t);
    }), $(document).on("submit", "#addData", function(e) {
        e.preventDefault();
        var t = i().getCookie(), a = JSON.parse(t).categoryData_id, o = {};
        o.field_name = $("#fieldName").val(), o.description = $("#description").val();
        var r = JSON.stringify(o);
        n().addData(r, a).then(function(e) {
            Finch.navigate("categoryData");
        }, function(e) {
            i().log(e);
        });
    }), $(document).on("click", ".deleteData", function(e) {
        e.preventDefault();
        var t = $(this).data("route");
        n().deleteData(t);
    }), $(document).on("click", "#dashboard", function(e) {
        e.preventDefault(), Finch.navigate("dashboard");
    }), $(document).on("click", "#btnEdit", function(e) {
        e.preventDefault();
        var t = $(e.target).data("id");
        $(".title-" + t).hide(), $("#editCategoryField-" + t).show(), $("#editTitle-" + t).focus();
    }), $(document).on("click", "#btnSave", function(e) {
        e.preventDefault();
        var t = $(e.target).data("id"), a = {};
        a.title = $("[name=titleName-" + t + "]").val(), n().editCategory(t, a);
    }), $(document).on("click", "#btnEditData", function(e) {
        e.preventDefault();
        var t = $(e.target).data("id");
        $(".fieldName-" + t).hide(), $(".description-" + t).hide(), $("#editDataField-" + t).show(), 
        $("#editTitleField-" + t).show(), $("#editFieldName-" + t).focus();
    }), $(document).on("click", "#btnSaveData", function(e) {
        e.preventDefault();
        var t = $(e.target).data("id"), a = {};
        a.field_name = $("[name=fieldName-" + t + "]").val(), a.description = $("[name=description-" + t + "]").val(), 
        n().editData(t, a);
    }), $(document).on("submit", "#login-form", function(e) {
        e.preventDefault();
        var t = {};
        t.email = document.forms.form.email.value, t.password = document.forms.form.password.value;
        var a = JSON.stringify(t);
        o().login(a).then(function(e) {
            i().log(e);
            var t = e.token, a = e.user_id, o = JSON.stringify({
                token: t,
                user_id: a
            });
            i().setCookie(o), null == JSON.parse(i().getCookie()).token ? alert("Invalid one") : ($(".login").hide(), 
            Finch.navigate("dashboard"));
        }, function(e) {
            i().log(e);
        });
    }), $(document).on("submit", "#register-form", function(e) {
        e.preventDefault();
        var t = {};
        t.name = document.forms["register-form"].name.value, t.email = document.forms["register-form"].email.value, 
        t.password = document.forms["register-form"].password.value;
        var a = JSON.stringify(t);
        o().register(a).then(function(e) {
            i().log(e);
            var t = e.token, a = e.user_id, o = JSON.stringify({
                token: t,
                user_id: a
            });
            i().setCookie(o), Finch.navigate("dashboard");
        }, function(e) {
            i().log(e);
        });
    }), $(document).on("submit", "#forgot-form", function(e) {
        e.preventDefault();
        var t = {};
        t.email = document.forms["forgot-form"].email.value, localStore_email = document.forms["forgot-form"].email.value;
        var a = JSON.stringify(t);
        o().forgot(a).then(function(e) {
            i().setCookie(localStore_email);
            var t = $("#token-verify").html();
            i().render(t);
        }, function(e) {
            i().log(e);
        });
    }), $(document).on("submit", "#recover-form", function(e) {
        e.preventDefault();
        var t = {};
        t.email = i().getCookie(), t.token = document.forms["recover-form"].token.value, 
        t.password = document.forms["recover-form"].password.value;
        var a = JSON.stringify(t);
        o().recover(a).then(function(e) {
            window.localStorage.clear(), Finch.navigate("login");
        }, function(e) {
            alert("Error");
        });
    }), $(document).on("click", "#resend-token", function(e) {
        e.preventDefault();
        var t = {};
        t.email = i().getCookie();
        var a = JSON.stringify(t);
        o().resendToken(a).then(function(e) {
            alert("Token send successfulluy");
        }, function(e) {
            alert("Error");
        });
    }), $(document).on("click", "#logout", function(e) {
        e.preventDefault(), window.localStorage.clear(), Finch.navigate("login"), location.reload();
    }), Finch.route("addCategory/", function() {
        e().renderAddCategory();
    }), Finch.route("categoryData/", function() {
        e().rendercategoryData();
    }), Finch.route("addCategoryData", function() {
        e().renderaddCategoryData();
    }), Finch.route("login", function() {
        t().renderLogin();
    }), Finch.route("/", function() {
        t().renderLogin();
    }), Finch.route("dashboard", function() {
        t().renderDashboard();
    }), Finch.route("forgot", function() {
        t().renderForgot();
    }), Finch.route("register", function() {
        t().renderRegister();
    }), $(document).ready(function() {
        Finch.listen();
    }), $(document).on("click", ".navigator", function(e) {
        e.preventDefault();
        var t = $(this).data("route");
        Finch.call(t);
    }), $(document).on("click", ".categoryData", function(e) {
        e.preventDefault();
        var t = $(this).data("route");
        !function(e, t) {
            var a = JSON.parse(i().getCookie());
            a[e] = t;
            var o = JSON.stringify(a);
            i().setCookie(o);
        }("categoryData_id", $(this).data("id")), Finch.call(t);
    });
}();